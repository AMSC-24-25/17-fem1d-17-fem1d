services:
  # Default runtime - TomlMain
  fem-runtime:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: runtime
    image: fem:runtime
    container_name: fem-runtime
    volumes:
      - ../build/output:/app/build/output
      - ../config:/app/config
    working_dir: /app/build
    command: ["toml", "config/good-examples/polynomial_2d.toml"]

  # Interactive bash runtime
  fem-bash:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: runtime
    image: fem:runtime
    container_name: fem-bash
    stdin_open: true
    tty: true
    volumes:
      - ../build/output:/app/build/output
      - ../config:/app/config
    working_dir: /app
    command: ["bash"]

  # Development environment
  fem-dev:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: development
    image: fem:dev
    container_name: fem-dev
    volumes:
      - ..:/app
      - /app/build  # Anonymous volume for build artifacts
    working_dir: /app
    stdin_open: true
    tty: true
    command: ["/bin/bash"]

  # Run all good examples
  fem-test:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: runtime
    image: fem:runtime
    container_name: fem-test
    volumes:
      - ../build/output:/app/build/output
    working_dir: /app/build
    command: ["examples"]

  # Sequential version for performance comparison
  fem-sequential:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: runtime
    image: fem:runtime
    container_name: fem-sequential
    volumes:
      - ../build/output:/app/build/output
    working_dir: /app/build
    command: ["sequential", "config/good-examples/polynomial_3d.toml"]

  # Speedup analysis (default behavior)
  fem-speedup:
    build:
      context: ..
      dockerfile: docker/Dockerfile
      target: runtime
    image: fem:runtime
    container_name: fem-speedup
    volumes:
      - ../build/output:/app/build/output
    working_dir: /app/build
    command: ["speedup"]
